(function(e, a) { for(var i in a) e[i] = a[i]; }(exports, /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/sfu/handler.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "../types/src/db/connection.ts":
/*!*************************************!*\
  !*** ../types/src/db/connection.ts ***!
  \*************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/db/connection.ts?");

/***/ }),

/***/ "../types/src/db/participant.ts":
/*!**************************************!*\
  !*** ../types/src/db/participant.ts ***!
  \**************************************/
/*! exports provided: Role, createParticipantDecoder */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Role\", function() { return Role; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createParticipantDecoder\", function() { return createParticipantDecoder; });\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ts.data.json */ \"ts.data.json\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ts_data_json__WEBPACK_IMPORTED_MODULE_0__);\n\nvar Role;\n\n(function (Role) {\n  Role[\"host\"] = \"host\";\n  Role[\"guest\"] = \"guest\";\n})(Role || (Role = {}));\n\nconst createParticipantDecoder = ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].object({\n  role: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].oneOf(Object.values(Role).map(v => ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(v)), \"role\")\n}, \"CreateParticipant\");\n\n//# sourceURL=webpack:///../types/src/db/participant.ts?");

/***/ }),

/***/ "../types/src/db/recvTransport.ts":
/*!****************************************!*\
  !*** ../types/src/db/recvTransport.ts ***!
  \****************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/db/recvTransport.ts?");

/***/ }),

/***/ "../types/src/db/sendTransport.ts":
/*!****************************************!*\
  !*** ../types/src/db/sendTransport.ts ***!
  \****************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/db/sendTransport.ts?");

/***/ }),

/***/ "../types/src/db/server.ts":
/*!*********************************!*\
  !*** ../types/src/db/server.ts ***!
  \*********************************/
/*! exports provided: createServerDecoder */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createServerDecoder\", function() { return createServerDecoder; });\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ts.data.json */ \"ts.data.json\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ts_data_json__WEBPACK_IMPORTED_MODULE_0__);\n\nconst createServerDecoder = ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].object({\n  ip: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  token: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  port: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].number\n}, \"CreateServer\");\n\n//# sourceURL=webpack:///../types/src/db/server.ts?");

/***/ }),

/***/ "../types/src/db/stream.ts":
/*!*********************************!*\
  !*** ../types/src/db/stream.ts ***!
  \*********************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/db/stream.ts?");

/***/ }),

/***/ "../types/src/db/streamConsumer.ts":
/*!*****************************************!*\
  !*** ../types/src/db/streamConsumer.ts ***!
  \*****************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/db/streamConsumer.ts?");

/***/ }),

/***/ "../types/src/index.ts":
/*!*****************************!*\
  !*** ../types/src/index.ts ***!
  \*****************************/
/*! exports provided: Role, createParticipantDecoder, createServerDecoder */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _routes__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./routes */ \"../types/src/routes.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _mediasoup__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./mediasoup */ \"../types/src/mediasoup.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _topology__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./topology */ \"../types/src/topology.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _db_connection__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./db/connection */ \"../types/src/db/connection.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _db_participant__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./db/participant */ \"../types/src/db/participant.ts\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"Role\", function() { return _db_participant__WEBPACK_IMPORTED_MODULE_4__[\"Role\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createParticipantDecoder\", function() { return _db_participant__WEBPACK_IMPORTED_MODULE_4__[\"createParticipantDecoder\"]; });\n\n/* harmony import */ var _db_recvTransport__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./db/recvTransport */ \"../types/src/db/recvTransport.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _db_sendTransport__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./db/sendTransport */ \"../types/src/db/sendTransport.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _db_server__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./db/server */ \"../types/src/db/server.ts\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createServerDecoder\", function() { return _db_server__WEBPACK_IMPORTED_MODULE_7__[\"createServerDecoder\"]; });\n\n/* harmony import */ var _db_stream__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./db/stream */ \"../types/src/db/stream.ts\");\n/* empty/unused harmony star reexport *//* harmony import */ var _db_streamConsumer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./db/streamConsumer */ \"../types/src/db/streamConsumer.ts\");\n/* empty/unused harmony star reexport */\n\n\n\n\n\n\n\n\n\n\n//# sourceURL=webpack:///../types/src/index.ts?");

/***/ }),

/***/ "../types/src/mediasoup.ts":
/*!*********************************!*\
  !*** ../types/src/mediasoup.ts ***!
  \*********************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/mediasoup.ts?");

/***/ }),

/***/ "../types/src/routes.ts":
/*!******************************!*\
  !*** ../types/src/routes.ts ***!
  \******************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/routes.ts?");

/***/ }),

/***/ "../types/src/topology.ts":
/*!********************************!*\
  !*** ../types/src/topology.ts ***!
  \********************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n\n\n//# sourceURL=webpack:///../types/src/topology.ts?");

/***/ }),

/***/ "./src/db/repositories/connectionRepository.ts":
/*!*****************************************************!*\
  !*** ./src/db/repositories/connectionRepository.ts ***!
  \*****************************************************/
/*! exports provided: createConnection, deleteConnection, getConnection, getConnectionsByToken, getAllConnections, patchConnection, findConnectionByRecvTransportId */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createConnection\", function() { return createConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteConnection\", function() { return deleteConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getConnection\", function() { return getConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getConnectionsByToken\", function() { return getConnectionsByToken; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllConnections\", function() { return getAllConnections; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"patchConnection\", function() { return patchConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"findConnectionByRecvTransportId\", function() { return findConnectionByRecvTransportId; });\n/* harmony import */ var _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../io/exceptions/PicnicError */ \"./src/io/exceptions/PicnicError.ts\");\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\n\n\nasync function createConnection(data) {\n  const connection = new _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"](data);\n  await connection.save();\n  return connection.toJSON();\n}\nasync function deleteConnection({\n  connectionId\n}) {\n  await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"].delete({\n    connectionId\n  });\n}\nasync function getConnection({\n  connectionId\n}) {\n  var _doc$toJSON;\n\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"].get({\n    connectionId\n  }); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\nasync function getConnectionsByToken({\n  token\n}) {\n  // TODO: Add index to use query instead\n  // TODO: fix typing\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"].scan({\n    token: {\n      eq: token\n    }\n  }).exec();\n  return results;\n}\nasync function getAllConnections() {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"].scan().exec();\n  return results;\n}\nasync function patchConnection(params) {\n  const {\n    connectionId,\n    ...rest\n  } = params;\n\n  try {\n    var _doc$toJSON2;\n\n    const doc = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"].update({\n      connectionId\n    }, rest); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n    return (_doc$toJSON2 = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON2 !== void 0 ? _doc$toJSON2 : null;\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"patchConnection: fail\", e);\n  }\n}\nasync function findConnectionByRecvTransportId(recvTransportId) {\n  try {\n    const results = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ConnectionModel\"].scan({\n      recvTransportId: {\n        eq: recvTransportId\n      }\n    }).exec();\n    return results;\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"findConnectionByRecvTransportId: failed\", e);\n  }\n}\n\n//# sourceURL=webpack:///./src/db/repositories/connectionRepository.ts?");

/***/ }),

/***/ "./src/db/repositories/participantRepository.ts":
/*!******************************************************!*\
  !*** ./src/db/repositories/participantRepository.ts ***!
  \******************************************************/
/*! exports provided: createParticipant, getParticipant, getAllParticipants */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createParticipant\", function() { return createParticipant; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getParticipant\", function() { return getParticipant; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllParticipants\", function() { return getAllParticipants; });\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! uuid */ \"uuid\");\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(uuid__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\n\n\nasync function createParticipant(params) {\n  const participant = { ...params,\n    token: Object(uuid__WEBPACK_IMPORTED_MODULE_0__[\"v4\"])()\n  };\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ParticipantModel\"].create(participant);\n  return doc.toJSON();\n}\nasync function getParticipant(token) {\n  var _doc$toJSON;\n\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ParticipantModel\"].get(token); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\nasync function getAllParticipants() {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"ParticipantModel\"].scan().exec();\n  return results;\n}\n\n//# sourceURL=webpack:///./src/db/repositories/participantRepository.ts?");

/***/ }),

/***/ "./src/db/repositories/recvTransportRepository.ts":
/*!********************************************************!*\
  !*** ./src/db/repositories/recvTransportRepository.ts ***!
  \********************************************************/
/*! exports provided: createRecvTransport, deleteRecvTransport, getRecvTransport, getAllRecvTransport */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createRecvTransport\", function() { return createRecvTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteRecvTransport\", function() { return deleteRecvTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getRecvTransport\", function() { return getRecvTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllRecvTransport\", function() { return getAllRecvTransport; });\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\n\nasync function createRecvTransport(transport) {\n  await _schema__WEBPACK_IMPORTED_MODULE_0__[\"RecvTransportModel\"].create(transport);\n}\nasync function deleteRecvTransport({\n  transportId\n}) {\n  await _schema__WEBPACK_IMPORTED_MODULE_0__[\"RecvTransportModel\"].delete({\n    transportId\n  });\n}\nasync function getRecvTransport({\n  transportId\n}) {\n  var _doc$toJSON;\n\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"RecvTransportModel\"].get({\n    transportId\n  }); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\nasync function getAllRecvTransport() {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"RecvTransportModel\"].scan().exec();\n  return results;\n}\n\n//# sourceURL=webpack:///./src/db/repositories/recvTransportRepository.ts?");

/***/ }),

/***/ "./src/db/repositories/sendTransportRepository.ts":
/*!********************************************************!*\
  !*** ./src/db/repositories/sendTransportRepository.ts ***!
  \********************************************************/
/*! exports provided: createSendTransport, deleteSendTransport, getSendTransport, patchSendTransport, getAllSendTransport */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createSendTransport\", function() { return createSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteSendTransport\", function() { return deleteSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSendTransport\", function() { return getSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"patchSendTransport\", function() { return patchSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllSendTransport\", function() { return getAllSendTransport; });\n/* harmony import */ var _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../io/exceptions/PicnicError */ \"./src/io/exceptions/PicnicError.ts\");\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\n\n\nasync function createSendTransport(transport) {\n  await _schema__WEBPACK_IMPORTED_MODULE_1__[\"SendTransportModel\"].create(transport);\n}\nasync function deleteSendTransport({\n  transportId\n}) {\n  try {\n    await _schema__WEBPACK_IMPORTED_MODULE_1__[\"SendTransportModel\"].delete({\n      transportId\n    });\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"deleteSendTransport: failed\", e);\n  }\n}\nasync function getSendTransport({\n  transportId\n}) {\n  var _doc$toJSON;\n\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"SendTransportModel\"].get({\n    transportId\n  }); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\nasync function patchSendTransport(params) {\n  var _doc$toJSON2;\n\n  const {\n    transportId,\n    ...rest\n  } = params;\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"SendTransportModel\"].update({\n    transportId\n  }, rest); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON2 = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON2 !== void 0 ? _doc$toJSON2 : null;\n}\nasync function getAllSendTransport() {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_1__[\"SendTransportModel\"].scan().exec();\n  return results;\n}\n\n//# sourceURL=webpack:///./src/db/repositories/sendTransportRepository.ts?");

/***/ }),

/***/ "./src/db/repositories/serverRepository.ts":
/*!*************************************************!*\
  !*** ./src/db/repositories/serverRepository.ts ***!
  \*************************************************/
/*! exports provided: createServer, getServer, getAllServers */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createServer\", function() { return createServer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getServer\", function() { return getServer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllServers\", function() { return getAllServers; });\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\n\nasync function createServer(server) {\n  // TODO: Use TTL to detect unexpected die to recover\n  const doc = new _schema__WEBPACK_IMPORTED_MODULE_0__[\"ServerModel\"](server);\n  await doc.save();\n  return doc.toJSON();\n}\nasync function getServer({\n  ip,\n  port\n}) {\n  var _doc$toJSON;\n\n  // TODO: fix dynamoose typescript for number key\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const key = {\n    ip,\n    port\n  };\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"ServerModel\"].get(key); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\nasync function getAllServers() {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"ServerModel\"].scan().exec();\n  return results;\n}\n\n//# sourceURL=webpack:///./src/db/repositories/serverRepository.ts?");

/***/ }),

/***/ "./src/db/repositories/streamConsumerRepository.ts":
/*!*********************************************************!*\
  !*** ./src/db/repositories/streamConsumerRepository.ts ***!
  \*********************************************************/
/*! exports provided: createStreamConsumer, getAllStreamConsumers, findStreamConsumerByTransportId, findStreamConsumerBySourceTransportId, getStreamConsumer, deleteStreamConsumer, deleteStreamConsumerByTransportId, deleteStreamConsumerBySoourceTransportId, patchStreamConsumer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createStreamConsumer\", function() { return createStreamConsumer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllStreamConsumers\", function() { return getAllStreamConsumers; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"findStreamConsumerByTransportId\", function() { return findStreamConsumerByTransportId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"findStreamConsumerBySourceTransportId\", function() { return findStreamConsumerBySourceTransportId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getStreamConsumer\", function() { return getStreamConsumer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteStreamConsumer\", function() { return deleteStreamConsumer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteStreamConsumerByTransportId\", function() { return deleteStreamConsumerByTransportId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteStreamConsumerBySoourceTransportId\", function() { return deleteStreamConsumerBySoourceTransportId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"patchStreamConsumer\", function() { return patchStreamConsumer; });\n/* harmony import */ var _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../io/exceptions/PicnicError */ \"./src/io/exceptions/PicnicError.ts\");\n/* harmony import */ var _io_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../io/promises */ \"./src/io/promises.ts\");\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\nvar _process$env$STREAM_C;\n\n\n\n\nconst INDEX_SOURCE_TRANSPORT = (_process$env$STREAM_C = process.env.STREAM_CONSUMER_TABLE_INDEX_SOURCE_TRANSPORT) !== null && _process$env$STREAM_C !== void 0 ? _process$env$STREAM_C : \"\";\nasync function createStreamConsumer(stream) {\n  try {\n    const doc = await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].create(stream);\n    return doc.toJSON();\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"createStreamConsumer: failed\", e);\n  }\n}\nasync function getAllStreamConsumers() {\n  try {\n    const results = await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].scan().exec();\n    return results;\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"getAllStreamConsumers: failed\", e);\n  }\n}\nasync function findStreamConsumerByTransportId(transportId) {\n  try {\n    const results = await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].query({\n      transportId: {\n        eq: transportId\n      }\n    }).exec();\n    return results;\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"findStreamConsumerByTransportId: failed\", e);\n  }\n}\nasync function findStreamConsumerBySourceTransportId(sourceTransportId) {\n  try {\n    const results = await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].query({\n      sourceTransportId: {\n        eq: sourceTransportId\n      }\n    }).using(INDEX_SOURCE_TRANSPORT).exec();\n    return results;\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"findStreamConsumerBySourceTransportId: failed\", e);\n  }\n}\nasync function getStreamConsumer(transportId, consumerId) {\n  try {\n    var _result$toJSON;\n\n    const result = await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].get({\n      transportId,\n      consumerId\n    }); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n    return (_result$toJSON = result === null || result === void 0 ? void 0 : result.toJSON()) !== null && _result$toJSON !== void 0 ? _result$toJSON : null;\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"getStreamConsumer: failed\", e);\n  }\n}\nasync function deleteStreamConsumer(transportId, consumerId) {\n  try {\n    await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].delete({\n      consumerId,\n      transportId\n    });\n  } catch (e) {\n    throw new _io_exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_0__[\"default\"](\"deleteStreamConsumer: failed\", e);\n  }\n}\nasync function deleteStreamConsumerByTransportId(transportId) {\n  const items = await findStreamConsumerByTransportId(transportId);\n  const results = await Promise.allSettled(items.map(async item => deleteStreamConsumer(item.transportId, item.consumerId)));\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_1__[\"getAllSettledValues\"])(results, \"deleteStreamConsumerByTransportId: Unexpected Error\");\n}\nasync function deleteStreamConsumerBySoourceTransportId(sourceTransportId) {\n  const items = await findStreamConsumerBySourceTransportId(sourceTransportId);\n  const results = await Promise.allSettled(items.map(async item => deleteStreamConsumer(item.transportId, item.consumerId)));\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_1__[\"getAllSettledValues\"])(results, \"deleteStreamConsumerBySoourceTransportId: Unexpected Error\");\n}\nasync function patchStreamConsumer(params) {\n  var _doc$toJSON;\n\n  const {\n    transportId,\n    consumerId,\n    ...rest\n  } = params;\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_2__[\"StreamConsumerModel\"].update({\n    transportId,\n    consumerId\n  }, rest); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\n\n//# sourceURL=webpack:///./src/db/repositories/streamConsumerRepository.ts?");

/***/ }),

/***/ "./src/db/repositories/streamRepository.ts":
/*!*************************************************!*\
  !*** ./src/db/repositories/streamRepository.ts ***!
  \*************************************************/
/*! exports provided: createStream, deleteStream, getStream, findStreamByTransportId, deleteStreamByTransportId, getAllStreams, patchStream */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createStream\", function() { return createStream; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteStream\", function() { return deleteStream; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getStream\", function() { return getStream; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"findStreamByTransportId\", function() { return findStreamByTransportId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deleteStreamByTransportId\", function() { return deleteStreamByTransportId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllStreams\", function() { return getAllStreams; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"patchStream\", function() { return patchStream; });\n/* harmony import */ var _schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../schema */ \"./src/db/schema.ts\");\n\nasync function createStream(stream) {\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"StreamModel\"].create(stream);\n  return doc.toJSON();\n}\nasync function deleteStream(transportId, producerId) {\n  await _schema__WEBPACK_IMPORTED_MODULE_0__[\"StreamModel\"].delete({\n    transportId,\n    producerId\n  });\n}\nasync function getStream(transportId, producerId) {\n  var _doc$toJSON;\n\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"StreamModel\"].get({\n    transportId,\n    producerId\n  }); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON !== void 0 ? _doc$toJSON : null;\n}\nasync function findStreamByTransportId(transportId) {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"StreamModel\"].scan({\n    transportId: {\n      eq: transportId\n    }\n  }).exec();\n  return results;\n}\nasync function deleteStreamByTransportId(transportId) {\n  const items = await findStreamByTransportId(transportId);\n  await Promise.all(items.map(async item => deleteStream(item.transportId, item.producerId)));\n}\nasync function getAllStreams() {\n  const results = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"StreamModel\"].scan().exec();\n  return results;\n}\nasync function patchStream(params) {\n  var _doc$toJSON2;\n\n  const {\n    transportId,\n    producerId,\n    ...rest\n  } = params;\n  const doc = await _schema__WEBPACK_IMPORTED_MODULE_0__[\"StreamModel\"].update({\n    transportId,\n    producerId\n  }, rest); // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\n  return (_doc$toJSON2 = doc === null || doc === void 0 ? void 0 : doc.toJSON()) !== null && _doc$toJSON2 !== void 0 ? _doc$toJSON2 : null;\n}\n\n//# sourceURL=webpack:///./src/db/repositories/streamRepository.ts?");

/***/ }),

/***/ "./src/db/schema.ts":
/*!**************************!*\
  !*** ./src/db/schema.ts ***!
  \**************************/
/*! exports provided: serverSchema, ServerModel, participantSchema, ParticipantModel, connectionSchema, ConnectionModel, recvTransportSchema, RecvTransportModel, sendTransportSchema, SendTransportModel, streamSchema, StreamModel, streamConsumerSchema, StreamConsumerModel */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"serverSchema\", function() { return serverSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ServerModel\", function() { return ServerModel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"participantSchema\", function() { return participantSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ParticipantModel\", function() { return ParticipantModel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"connectionSchema\", function() { return connectionSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ConnectionModel\", function() { return ConnectionModel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"recvTransportSchema\", function() { return recvTransportSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RecvTransportModel\", function() { return RecvTransportModel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"sendTransportSchema\", function() { return sendTransportSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SendTransportModel\", function() { return SendTransportModel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"streamSchema\", function() { return streamSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"StreamModel\", function() { return StreamModel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"streamConsumerSchema\", function() { return streamConsumerSchema; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"StreamConsumerModel\", function() { return StreamConsumerModel; });\n/* harmony import */ var dynamoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dynamoose */ \"dynamoose\");\n/* harmony import */ var dynamoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dynamoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _types_src_db_participant__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../types/src/db/participant */ \"../types/src/db/participant.ts\");\nvar _process$env$STREAM_C, _process$env$SERVER_T, _process$env$PARTICIP, _process$env$CONNECTI, _process$env$RECV_TRA, _process$env$SEND_TRA, _process$env$STREAM_T, _process$env$STREAM_C2;\n\n\n // Depends on serverless-offline plugin which adds IS_OFFLINE to process.env when running offline\n\nif (process.env.IS_OFFLINE) {\n  dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"aws\"].ddb.local(\"http://localhost:9005\");\n}\n\nconst INDEX_SOURCE_TRANSPORT = (_process$env$STREAM_C = process.env.STREAM_CONSUMER_TABLE_INDEX_SOURCE_TRANSPORT) !== null && _process$env$STREAM_C !== void 0 ? _process$env$STREAM_C : \"\";\nconst serverSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  ip: {\n    type: String,\n    required: true,\n    hashKey: true\n  },\n  port: {\n    type: Number,\n    required: true,\n    rangeKey: true\n  },\n  token: {\n    type: String,\n    required: true\n  }\n});\nconst ServerModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$SERVER_T = process.env.SERVER_TABLE) !== null && _process$env$SERVER_T !== void 0 ? _process$env$SERVER_T : \"\", serverSchema);\nconst participantSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  token: {\n    type: String,\n    required: true,\n    hashKey: true\n  },\n  role: {\n    type: String,\n    required: true,\n    enum: [_types_src_db_participant__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _types_src_db_participant__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest]\n  }\n});\nconst ParticipantModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$PARTICIP = process.env.PARTICIPANT_TABLE) !== null && _process$env$PARTICIP !== void 0 ? _process$env$PARTICIP : \"\", participantSchema);\nconst connectionSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  connectionId: {\n    type: String,\n    required: true,\n    hashKey: true\n  },\n  token: {\n    type: String,\n    required: true\n  },\n  sendTransportId: {\n    type: String,\n    required: false\n  },\n  recvTransportId: {\n    type: String,\n    required: false\n  }\n});\nconst ConnectionModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$CONNECTI = process.env.CONNECTION_TABLE) !== null && _process$env$CONNECTI !== void 0 ? _process$env$CONNECTI : \"\", connectionSchema);\nconst recvTransportSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  transportId: {\n    type: String,\n    required: true,\n    hashKey: true\n  }\n});\nconst RecvTransportModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$RECV_TRA = process.env.RECV_TRANSPORT_TABLE) !== null && _process$env$RECV_TRA !== void 0 ? _process$env$RECV_TRA : \"\", recvTransportSchema);\nconst sendTransportSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  transportId: {\n    type: String,\n    required: true,\n    hashKey: true\n  },\n  audioTrack: {\n    type: String,\n    required: false\n  },\n  videoTrack: {\n    type: String,\n    required: false\n  }\n});\nconst SendTransportModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$SEND_TRA = process.env.SEND_TRANSPORT_TABLE) !== null && _process$env$SEND_TRA !== void 0 ? _process$env$SEND_TRA : \"\", sendTransportSchema);\nconst streamSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  transportId: {\n    type: String,\n    required: true,\n    hashKey: true\n  },\n  producerId: {\n    type: String,\n    required: true,\n    rangeKey: true\n  },\n  kind: {\n    type: String,\n    required: true,\n    enum: [\"audio\", \"video\"]\n  },\n  score: {\n    type: Number,\n    required: true\n  }\n});\nconst StreamModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$STREAM_T = process.env.STREAM_TABLE) !== null && _process$env$STREAM_T !== void 0 ? _process$env$STREAM_T : \"\", streamSchema);\nconst streamConsumerSchema = new dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"Schema\"]({\n  transportId: {\n    type: String,\n    required: true,\n    hashKey: true\n  },\n  consumerId: {\n    type: String,\n    required: true,\n    rangeKey: true\n  },\n  sourceTransportId: {\n    type: String,\n    required: true,\n    index: {\n      name: INDEX_SOURCE_TRANSPORT,\n      global: true,\n      project: true\n    }\n  },\n  producerId: {\n    type: String,\n    required: true\n  },\n  score: {\n    type: Number,\n    required: true\n  },\n  producerScore: {\n    type: Number,\n    required: true\n  }\n});\nconst StreamConsumerModel = Object(dynamoose__WEBPACK_IMPORTED_MODULE_0__[\"model\"])((_process$env$STREAM_C2 = process.env.STREAM_CONSUMER_TABLE) !== null && _process$env$STREAM_C2 !== void 0 ? _process$env$STREAM_C2 : \"\", streamConsumerSchema);\n\n//# sourceURL=webpack:///./src/db/schema.ts?");

/***/ }),

/***/ "./src/io/exceptions/ForbiddenError.ts":
/*!*********************************************!*\
  !*** ./src/io/exceptions/ForbiddenError.ts ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return ForbiddenError; });\n/* harmony import */ var _InvalidRequestError__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./InvalidRequestError */ \"./src/io/exceptions/InvalidRequestError.ts\");\n\nclass ForbiddenError extends _InvalidRequestError__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor() {\n    super(\"Forbidden\", 403);\n  }\n\n}\n\n//# sourceURL=webpack:///./src/io/exceptions/ForbiddenError.ts?");

/***/ }),

/***/ "./src/io/exceptions/InvalidRequestError.ts":
/*!**************************************************!*\
  !*** ./src/io/exceptions/InvalidRequestError.ts ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return InvalidRequestError; });\nclass InvalidRequestError extends Error {\n  constructor(message = \"invalid request\", code = 400) {\n    super(message);\n    this.code = code;\n  }\n\n}\n\n//# sourceURL=webpack:///./src/io/exceptions/InvalidRequestError.ts?");

/***/ }),

/***/ "./src/io/exceptions/PicnicError.ts":
/*!******************************************!*\
  !*** ./src/io/exceptions/PicnicError.ts ***!
  \******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return PicnicError; });\nclass PicnicError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.cause = cause;\n\n    if (true) {\n      console.error(\"PicnicError\", message, cause);\n    }\n  }\n\n}\n\n//# sourceURL=webpack:///./src/io/exceptions/PicnicError.ts?");

/***/ }),

/***/ "./src/io/io.ts":
/*!**********************!*\
  !*** ./src/io/io.ts ***!
  \**********************/
/*! exports provided: wsOnlyRoute, parse, parseHttpParticipantRequest, parseHttpAdminRequest, parseWsParticipantRequest, handleHttpErrorResponse, handleSuccessResponse, postToConnection, broadcastToConnections, handleWebSocketSuccessResponse, handleWebSocketErrorResponse */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"wsOnlyRoute\", function() { return wsOnlyRoute; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parse\", function() { return parse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseHttpParticipantRequest\", function() { return parseHttpParticipantRequest; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseHttpAdminRequest\", function() { return parseHttpAdminRequest; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseWsParticipantRequest\", function() { return parseWsParticipantRequest; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleHttpErrorResponse\", function() { return handleHttpErrorResponse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleSuccessResponse\", function() { return handleSuccessResponse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"postToConnection\", function() { return postToConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"broadcastToConnections\", function() { return broadcastToConnections; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleWebSocketSuccessResponse\", function() { return handleWebSocketSuccessResponse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleWebSocketErrorResponse\", function() { return handleWebSocketErrorResponse; });\n/* harmony import */ var _sentry_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @sentry/node */ \"@sentry/node\");\n/* harmony import */ var _sentry_node__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_sentry_node__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var aws_sdk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! aws-sdk */ \"aws-sdk\");\n/* harmony import */ var aws_sdk__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(aws_sdk__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ts.data.json */ \"ts.data.json\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(ts_data_json__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../db/repositories/connectionRepository */ \"./src/db/repositories/connectionRepository.ts\");\n/* harmony import */ var _security_security__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../security/security */ \"./src/security/security.ts\");\n/* harmony import */ var _exceptions_InvalidRequestError__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./exceptions/InvalidRequestError */ \"./src/io/exceptions/InvalidRequestError.ts\");\n/* harmony import */ var _promises__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./promises */ \"./src/io/promises.ts\");\nvar _process$env$WEBSOCKE;\n\n\n\n\n\n\n\n\nconst DOMAIN_NAME = (_process$env$WEBSOCKE = process.env.WEBSOCKET_DOMAIN) !== null && _process$env$WEBSOCKE !== void 0 ? _process$env$WEBSOCKE : \"\";\n\nif (process.env.SENTRY_ENVIRONMENT !== \"dev\") {\n  Object(_sentry_node__WEBPACK_IMPORTED_MODULE_0__[\"init\"])({\n    dsn: process.env.SENTRY_DNS,\n    environment: process.env.SENTRY_ENVIRONMENT\n  });\n}\n\nconst apigwManagementApi = new aws_sdk__WEBPACK_IMPORTED_MODULE_1__[\"ApiGatewayManagementApi\"](process.env.IS_OFFLINE ? {\n  apiVersion: \"2018-11-29\",\n  endpoint: `http://localhost:3001`\n} : {\n  apiVersion: \"2018-11-29\",\n  endpoint: `${DOMAIN_NAME}`\n});\nfunction wsOnlyRoute(event) {\n  const {\n    connectionId\n  } = event.requestContext;\n\n  if (!connectionId) {\n    throw new Error(`Route: Require websocket connection`);\n  }\n\n  return connectionId;\n}\nfunction parse(body) {\n  try {\n    return body === null ? body : JSON.parse(body);\n  } catch (e) {\n    throw new _exceptions_InvalidRequestError__WEBPACK_IMPORTED_MODULE_5__[\"default\"](`Unable to parse body: ${e.message}`);\n  }\n}\n\nfunction decode(data, decoder) {\n  const result = decoder.decode(data);\n\n  if (!result.isOk()) {\n    throw new _exceptions_InvalidRequestError__WEBPACK_IMPORTED_MODULE_5__[\"default\"](result.error);\n  }\n\n  return result.value;\n}\n\nfunction parseWsRequest(event, decoder) {\n  const body = parse(event.body);\n  const requestDecoder = ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].object({\n    token: ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].string,\n    data: decoder,\n    msgId: ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].string\n  }, \"WebSocketRequest\");\n  return decode(body, requestDecoder);\n}\n\nfunction parseHttpRequest(event, decoder) {\n  const token = event.headers[\"x-api-key\"];\n\n  if (!token) {\n    throw new _exceptions_InvalidRequestError__WEBPACK_IMPORTED_MODULE_5__[\"default\"](\"Missing x-api-key header\");\n  }\n\n  const body = parse(event.body);\n  return {\n    token,\n    data: decode(body, decoder)\n  };\n}\n\nasync function parseHttpParticipantRequest(event, roles, decoder) {\n  const result = parseHttpRequest(event, decoder);\n  const participant = await Object(_security_security__WEBPACK_IMPORTED_MODULE_4__[\"authParticipant\"])(result, roles);\n  return { ...result,\n    participant\n  };\n}\nasync function parseHttpAdminRequest(event, decoder) {\n  const result = parseHttpRequest(event, decoder);\n  await Object(_security_security__WEBPACK_IMPORTED_MODULE_4__[\"authAdmin\"])(result);\n  return result;\n}\nasync function parseWsParticipantRequest(event, roles, decoder) {\n  const result = parseWsRequest(event, decoder);\n  const participant = await Object(_security_security__WEBPACK_IMPORTED_MODULE_4__[\"authParticipant\"])(result, roles);\n  return { ...result,\n    participant\n  };\n}\nasync function handleHttpErrorResponse(e, msgId = null) {\n  if (e instanceof _exceptions_InvalidRequestError__WEBPACK_IMPORTED_MODULE_5__[\"default\"]) {\n    return {\n      statusCode: e.code,\n      body: JSON.stringify({\n        success: false,\n        error: e.message,\n        msgId\n      })\n    };\n  }\n\n  console.error(e);\n  Object(_sentry_node__WEBPACK_IMPORTED_MODULE_0__[\"captureException\"])(e);\n  await Object(_sentry_node__WEBPACK_IMPORTED_MODULE_0__[\"flush\"])(2000).catch(() => {\n    console.error(\"io.handleHttpErrorResponse: fail to flush errors\");\n  });\n  return {\n    statusCode: 500,\n    body: JSON.stringify({\n      success: false,\n      error: \"Unexpected Server error\"\n    })\n  };\n}\nfunction handleSuccessResponse(data, msgId = null) {\n  return {\n    statusCode: 200,\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\"\n    },\n    body: JSON.stringify({\n      type: \"response\",\n      success: true,\n      payload: data,\n      msgId\n    })\n  };\n}\nasync function postToConnection(connectionId, data) {\n  try {\n    await apigwManagementApi.postToConnection({\n      ConnectionId: connectionId,\n      Data: data\n    }).promise();\n  } catch (e) {\n    // 410 Gone error\n    // https://medium.com/@lancers/websocket-api-what-does-it-mean-that-disconnect-is-a-best-effort-event-317b7021456f\n    if (typeof e === \"object\" && (e === null || e === void 0 ? void 0 : e.statusCode) === 410) {\n      console.warn(\"io.postToConnection: client gone\", connectionId);\n    } else {\n      throw e;\n    }\n  }\n}\nasync function broadcastToConnections(data) {\n  const connections = await Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_3__[\"getAllConnections\"])();\n  const results = await Promise.allSettled(connections.map(async c => postToConnection(c.connectionId, data)));\n  Object(_promises__WEBPACK_IMPORTED_MODULE_6__[\"getAllSettledValues\"])(results, \"broadcastToConnections: Unexpected Error\");\n}\nasync function handleWebSocketSuccessResponse(connectionId, msgId, data) {\n  const result = handleSuccessResponse(data, msgId); // Lambda response is sent through WebSocket in Api Gateway but not in serverless offline\n  // https://github.com/dherault/serverless-offline/issues/1008\n\n  if (process.env.IS_OFFLINE) {\n    await postToConnection(connectionId, result.body);\n  }\n\n  return result;\n}\nasync function handleWebSocketErrorResponse(connectionId, msgId, e) {\n  const result = await handleHttpErrorResponse(e, msgId); // Lambda response is sent through WebSocket in Api Gateway but not in serverless offline\n  // https://github.com/dherault/serverless-offline/issues/1008\n\n  if (process.env.IS_OFFLINE) {\n    await postToConnection(connectionId, result.body);\n  }\n\n  return result;\n}\n\n//# sourceURL=webpack:///./src/io/io.ts?");

/***/ }),

/***/ "./src/io/promises.ts":
/*!****************************!*\
  !*** ./src/io/promises.ts ***!
  \****************************/
/*! exports provided: getAllSettledValues */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAllSettledValues\", function() { return getAllSettledValues; });\n/* harmony import */ var _sentry_node__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @sentry/node */ \"@sentry/node\");\n/* harmony import */ var _sentry_node__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_sentry_node__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./exceptions/PicnicError */ \"./src/io/exceptions/PicnicError.ts\");\n\n\nfunction getAllSettledValues(results, errorMessage) {\n  const errorIndexes = [];\n  const values = [];\n\n  for (let i = 0; i < results.length; i += 1) {\n    const result = results[i];\n\n    if (result.status === \"fulfilled\") {\n      values.push(result.value);\n    } else {\n      Object(_sentry_node__WEBPACK_IMPORTED_MODULE_0__[\"captureException\"])(result.reason);\n      errorIndexes.push(i);\n    }\n  }\n\n  if (errorIndexes.length > 0) {\n    throw new _exceptions_PicnicError__WEBPACK_IMPORTED_MODULE_1__[\"default\"](`${errorMessage} at indexes [${errorIndexes.join(\", \")}]`, null);\n  }\n\n  return values;\n}\n\n//# sourceURL=webpack:///./src/io/promises.ts?");

/***/ }),

/***/ "./src/security/security.ts":
/*!**********************************!*\
  !*** ./src/security/security.ts ***!
  \**********************************/
/*! exports provided: authAdmin, authParticipant */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"authAdmin\", function() { return authAdmin; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"authParticipant\", function() { return authParticipant; });\n/* harmony import */ var _db_repositories_participantRepository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db/repositories/participantRepository */ \"./src/db/repositories/participantRepository.ts\");\n/* harmony import */ var _io_exceptions_ForbiddenError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../io/exceptions/ForbiddenError */ \"./src/io/exceptions/ForbiddenError.ts\");\n\n\nfunction authAdmin({\n  token\n}) {\n  if (!process.env.SECRET) {\n    throw new Error(\"Missing SECRET env-vars\");\n  }\n\n  if (token !== process.env.SECRET) {\n    throw new Error(\"Someone is trying to access admin\");\n  }\n}\nasync function authParticipant({\n  token\n}, roles) {\n  const participant = await Object(_db_repositories_participantRepository__WEBPACK_IMPORTED_MODULE_0__[\"getParticipant\"])(token);\n\n  if (participant == null) {\n    throw new _io_exceptions_ForbiddenError__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\n  }\n\n  if (!roles.includes(participant.role)) {\n    throw new _io_exceptions_ForbiddenError__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\n  }\n\n  return participant;\n}\n\n//# sourceURL=webpack:///./src/security/security.ts?");

/***/ }),

/***/ "./src/sfu/connectionService.ts":
/*!**************************************!*\
  !*** ./src/sfu/connectionService.ts ***!
  \**************************************/
/*! exports provided: onConnect, onRefreshConnection, onPing, onDisconnect */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onConnect\", function() { return onConnect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onRefreshConnection\", function() { return onRefreshConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onPing\", function() { return onPing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onDisconnect\", function() { return onDisconnect; });\n/* harmony import */ var _db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db/repositories/connectionRepository */ \"./src/db/repositories/connectionRepository.ts\");\n/* harmony import */ var _io_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../io/promises */ \"./src/io/promises.ts\");\n/* harmony import */ var _recvTransportService__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./recvTransportService */ \"./src/sfu/recvTransportService.ts\");\n/* harmony import */ var _sendTransportService__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sendTransportService */ \"./src/sfu/sendTransportService.ts\");\n/* harmony import */ var _serverService__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./serverService */ \"./src/sfu/serverService.ts\");\n\n\n\n\n\n\nasync function closeConnection(params) {\n  var _connection$sendTrans, _connection$recvTrans;\n\n  const {\n    connection\n  } = params;\n\n  if (connection == null) {\n    return;\n  }\n\n  const results = await Promise.allSettled([Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"deleteConnection\"])({\n    connectionId: connection.connectionId\n  }), Object(_sendTransportService__WEBPACK_IMPORTED_MODULE_3__[\"closeSendTransport\"])({\n    connectionId: connection.connectionId,\n    transportId: (_connection$sendTrans = connection.sendTransportId) !== null && _connection$sendTrans !== void 0 ? _connection$sendTrans : null,\n    skipConnectionPatch: true\n  }), Object(_recvTransportService__WEBPACK_IMPORTED_MODULE_2__[\"closeRecvTransport\"])({\n    connectionId: connection.connectionId,\n    transportId: (_connection$recvTrans = connection.recvTransportId) !== null && _connection$recvTrans !== void 0 ? _connection$recvTrans : null,\n    skipConnectionPatch: true\n  })]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_1__[\"getAllSettledValues\"])(results, \"onDisconnect: Unexpected error\");\n}\n\nasync function removeOldConnections(event) {\n  const {\n    connectionId,\n    token\n  } = event;\n  const connections = await Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"getConnectionsByToken\"])({\n    token\n  });\n  const results = await Promise.allSettled(connections.filter(c => c.connectionId !== connectionId).map(async c => closeConnection({\n    connection: c\n  })));\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_1__[\"getAllSettledValues\"])(results, \"removeOldConnections: Unexpected error\");\n}\n\nasync function onConnect(event) {\n  const [routerCapabilities] = await Promise.all([Object(_serverService__WEBPACK_IMPORTED_MODULE_4__[\"requestServer\"])(\"/router-capabilities\", null), Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"createConnection\"])(event), removeOldConnections(event)]);\n  return routerCapabilities;\n} // Refresh is done with a new connection to overcome AWS 2hours hard limit\n\nasync function onRefreshConnection(event) {\n  const {\n    connectionId,\n    token\n  } = event;\n  const connections = await Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"getConnectionsByToken\"])({\n    token\n  });\n\n  if (connections.length !== 1) {\n    // We expect to have only one connection\n    return false;\n  }\n\n  const oldConnection = connections[0];\n  await Promise.allSettled([Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"createConnection\"])({ ...oldConnection,\n    connectionId\n  }), Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"deleteConnection\"])({\n    connectionId: oldConnection.connectionId\n  })]);\n  return true;\n}\nfunction onPing() {\n  return \"pong\";\n} // There is 2 types of disconnect clean & unclean\n//    - clean: client or server close explicitly\n//    - unclean: network errors, client crash...\n// TODO: handle clean disconnect on websocket timeout (i.e. 2 hours) without cutting the stream\n// TODO: handle reconnect after unclean (client crash)\n// TODO: handle disconnect (pause stream?) when unclean disconnect (idle timeout is 10min)\n// TODO: prevent idle timeout by sending ping\n\nasync function onDisconnect(event) {\n  const {\n    connectionId\n  } = event; // TODO: do not destroy directly the transport\n  // Try to handle reconnect via a new websocket for 30s?\n\n  const connection = await Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"getConnection\"])({\n    connectionId\n  });\n  await closeConnection({\n    connection\n  });\n}\n\n//# sourceURL=webpack:///./src/sfu/connectionService.ts?");

/***/ }),

/***/ "./src/sfu/handler.ts":
/*!****************************!*\
  !*** ./src/sfu/handler.ts ***!
  \****************************/
/*! exports provided: routerCapabilities, refreshConnection, ping, disconnect, initConnect, createConnect, createSend, getStreams, createReceive, handleOnChangeStreamState, handleOnChangeConsumerStreamState, handleGetConsumerStreamState */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"routerCapabilities\", function() { return routerCapabilities; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"refreshConnection\", function() { return refreshConnection; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ping\", function() { return ping; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"disconnect\", function() { return disconnect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"initConnect\", function() { return initConnect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createConnect\", function() { return createConnect; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createSend\", function() { return createSend; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getStreams\", function() { return getStreams; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createReceive\", function() { return createReceive; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleOnChangeStreamState\", function() { return handleOnChangeStreamState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleOnChangeConsumerStreamState\", function() { return handleOnChangeConsumerStreamState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"handleGetConsumerStreamState\", function() { return handleGetConsumerStreamState; });\n/* harmony import */ var source_map_support_register__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! source-map-support/register */ \"source-map-support/register\");\n/* harmony import */ var source_map_support_register__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(source_map_support_register__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @amfa-team/types */ \"../types/src/index.ts\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ts.data.json */ \"ts.data.json\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(ts_data_json__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../db/repositories/streamRepository */ \"./src/db/repositories/streamRepository.ts\");\n/* harmony import */ var _io_io__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../io/io */ \"./src/io/io.ts\");\n/* harmony import */ var _connectionService__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./connectionService */ \"./src/sfu/connectionService.ts\");\n/* harmony import */ var _recvTransportService__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./recvTransportService */ \"./src/sfu/recvTransportService.ts\");\n/* harmony import */ var _sendTransportService__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./sendTransportService */ \"./src/sfu/sendTransportService.ts\");\n/* harmony import */ var _streamConsumerService__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./streamConsumerService */ \"./src/sfu/streamConsumerService.ts\");\n/* harmony import */ var _streamService__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./streamService */ \"./src/sfu/streamService.ts\");\n// eslint-disable-next-line import/no-unassigned-import\n\n\n\n\n\n\n\n\n\n\nasync function routerCapabilities(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].isNull(null));\n\n    try {\n      const payload = await Object(_connectionService__WEBPACK_IMPORTED_MODULE_5__[\"onConnect\"])({\n        connectionId,\n        token: req.token\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function refreshConnection(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].isNull(null));\n\n    try {\n      const payload = await Object(_connectionService__WEBPACK_IMPORTED_MODULE_5__[\"onRefreshConnection\"])({\n        connectionId,\n        token: req.token\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function ping(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].isNull(null));\n\n    try {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, Object(_connectionService__WEBPACK_IMPORTED_MODULE_5__[\"onPing\"])());\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function disconnect(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    try {\n      await Object(_connectionService__WEBPACK_IMPORTED_MODULE_5__[\"onDisconnect\"])({\n        connectionId\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleSuccessResponse\"])(null);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleHttpErrorResponse\"])(connectionId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleHttpErrorResponse\"])(connectionId, e);\n  }\n}\nasync function initConnect(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], // No validation, it's just a pipe\n    ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].succeed);\n\n    try {\n      const params = {\n        connectionId,\n        data: req.data\n      };\n      const payload = req.data.type === \"send\" ? await Object(_sendTransportService__WEBPACK_IMPORTED_MODULE_7__[\"onInitSendTransport\"])(params) : await Object(_recvTransportService__WEBPACK_IMPORTED_MODULE_6__[\"onInitRecvTransport\"])(params);\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function createConnect(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], // No validation, it's just a pipe\n    ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].succeed);\n\n    try {\n      const params = {\n        connectionId,\n        data: req.data\n      };\n      const payload = req.data.type === \"send\" ? await Object(_sendTransportService__WEBPACK_IMPORTED_MODULE_7__[\"onConnectSendTransport\"])(params) : await Object(_recvTransportService__WEBPACK_IMPORTED_MODULE_6__[\"onConnectRecvTransport\"])(params);\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function createSend(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host], _streamService__WEBPACK_IMPORTED_MODULE_9__[\"decodeSendParams\"]);\n\n    try {\n      const producerId = await Object(_streamService__WEBPACK_IMPORTED_MODULE_9__[\"onCreateStream\"])({\n        connectionId,\n        data: req.data\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, producerId);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function getStreams(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].isNull(null));\n    const streams = await Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_3__[\"getAllStreams\"])();\n\n    try {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, streams);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function createReceive(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], _streamConsumerService__WEBPACK_IMPORTED_MODULE_8__[\"decodeRecvParams\"]);\n\n    try {\n      const payload = await Object(_streamConsumerService__WEBPACK_IMPORTED_MODULE_8__[\"onCreateStreamConsumer\"])({\n        connectionId,\n        data: req.data\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function handleOnChangeStreamState(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], _streamService__WEBPACK_IMPORTED_MODULE_9__[\"decodeOnChangeStreamStateData\"]);\n\n    try {\n      const payload = await Object(_streamService__WEBPACK_IMPORTED_MODULE_9__[\"onChangeStreamState\"])({\n        connectionId,\n        data: req.data\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function handleOnChangeConsumerStreamState(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], _streamConsumerService__WEBPACK_IMPORTED_MODULE_8__[\"decodeChangeStreamConsumerStateData\"]);\n\n    try {\n      const payload = await Object(_streamConsumerService__WEBPACK_IMPORTED_MODULE_8__[\"onChangeStreamConsumerState\"])({\n        data: req.data\n      });\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\nasync function handleGetConsumerStreamState(event) {\n  const connectionId = Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"wsOnlyRoute\"])(event);\n\n  try {\n    const req = await Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"parseWsParticipantRequest\"])(event, [_amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].host, _amfa_team_types__WEBPACK_IMPORTED_MODULE_1__[\"Role\"].guest], ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].object({\n      consumerId: ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].string,\n      transportId: ts_data_json__WEBPACK_IMPORTED_MODULE_2__[\"JsonDecoder\"].string\n    }, \"ConsumerKey\"));\n\n    try {\n      const payload = await Object(_streamConsumerService__WEBPACK_IMPORTED_MODULE_8__[\"getStreamConsumerState\"])(req.data);\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketSuccessResponse\"])(connectionId, req.msgId, payload);\n    } catch (e) {\n      return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, req.msgId, e);\n    }\n  } catch (e) {\n    return Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"handleWebSocketErrorResponse\"])(connectionId, null, e);\n  }\n}\n\n//# sourceURL=webpack:///./src/sfu/handler.ts?");

/***/ }),

/***/ "./src/sfu/recvTransportService.ts":
/*!*****************************************!*\
  !*** ./src/sfu/recvTransportService.ts ***!
  \*****************************************/
/*! exports provided: onInitRecvTransport, onConnectRecvTransport, closeRecvTransport, onRecvTransportClose */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onInitRecvTransport\", function() { return onInitRecvTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onConnectRecvTransport\", function() { return onConnectRecvTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"closeRecvTransport\", function() { return closeRecvTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onRecvTransportClose\", function() { return onRecvTransportClose; });\n/* harmony import */ var _db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db/repositories/connectionRepository */ \"./src/db/repositories/connectionRepository.ts\");\n/* harmony import */ var _db_repositories_recvTransportRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/repositories/recvTransportRepository */ \"./src/db/repositories/recvTransportRepository.ts\");\n/* harmony import */ var _io_promises__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../io/promises */ \"./src/io/promises.ts\");\n/* harmony import */ var _serverService__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./serverService */ \"./src/sfu/serverService.ts\");\n/* harmony import */ var _streamConsumerService__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./streamConsumerService */ \"./src/sfu/streamConsumerService.ts\");\n\n\n\n\n\nasync function onInitRecvTransport(event) {\n  const {\n    connectionId,\n    data\n  } = event;\n\n  if (data.type !== \"recv\") {\n    throw new Error(\"onInitRecvTransport: type should be recv\");\n  }\n\n  const connectionInfo = await Object(_serverService__WEBPACK_IMPORTED_MODULE_3__[\"postToServer\"])(\"/connect/init\", data); // TODO: Handle connection removed in between\n\n  await Promise.all([Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"patchConnection\"])({\n    connectionId,\n    recvTransportId: connectionInfo.transportId\n  }), Object(_db_repositories_recvTransportRepository__WEBPACK_IMPORTED_MODULE_1__[\"createRecvTransport\"])({\n    transportId: connectionInfo.transportId\n  })]);\n  return connectionInfo;\n}\nasync function onConnectRecvTransport(event) {\n  return Object(_serverService__WEBPACK_IMPORTED_MODULE_3__[\"postToServer\"])(\"/connect/create\", event.data);\n}\nasync function closeRecvTransport(params) {\n  if (params.transportId == null) {\n    return;\n  }\n\n  const results = await Promise.allSettled([// Keep mediasoup resources for 30s as we might have pending requests\n  // We don't want to have mediasoup in sync, as API is the source of trust\n  // So we don't want to have mediasoup resources removed before API side (hello concurrency hell)\n  // Moreover this could help in future to cancel destroy in case of reconnect\n  Object(_serverService__WEBPACK_IMPORTED_MODULE_3__[\"postToServer\"])(\"/connect/destroy\", {\n    transportId: params.transportId,\n    delay: 30000\n  }), Object(_db_repositories_recvTransportRepository__WEBPACK_IMPORTED_MODULE_1__[\"deleteRecvTransport\"])({\n    transportId: params.transportId\n  }), // No need to destroy mediasoup consumer as it will be done automatically when closing transport\n  Object(_streamConsumerService__WEBPACK_IMPORTED_MODULE_4__[\"closeConsumer\"])({\n    transportId: params.transportId,\n    destroy: false,\n    consumerId: null\n  }), params.skipConnectionPatch ? Promise.resolve(null) : Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"patchConnection\"])({\n    connectionId: params.connectionId,\n    recvTransportId: null\n  })]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_2__[\"getAllSettledValues\"])(results, \"closeRecvTransportClose: Unexpected error\");\n}\nasync function onRecvTransportClose(event) {\n  await closeRecvTransport({ ...event,\n    skipConnectionPatch: false\n  });\n}\n\n//# sourceURL=webpack:///./src/sfu/recvTransportService.ts?");

/***/ }),

/***/ "./src/sfu/sendTransportService.ts":
/*!*****************************************!*\
  !*** ./src/sfu/sendTransportService.ts ***!
  \*****************************************/
/*! exports provided: onInitSendTransport, onConnectSendTransport, closeSendTransport, onSendTransportClose */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onInitSendTransport\", function() { return onInitSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onConnectSendTransport\", function() { return onConnectSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"closeSendTransport\", function() { return closeSendTransport; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onSendTransportClose\", function() { return onSendTransportClose; });\n/* harmony import */ var _db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db/repositories/connectionRepository */ \"./src/db/repositories/connectionRepository.ts\");\n/* harmony import */ var _db_repositories_sendTransportRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/repositories/sendTransportRepository */ \"./src/db/repositories/sendTransportRepository.ts\");\n/* harmony import */ var _io_promises__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../io/promises */ \"./src/io/promises.ts\");\n/* harmony import */ var _serverService__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./serverService */ \"./src/sfu/serverService.ts\");\n/* harmony import */ var _streamService__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./streamService */ \"./src/sfu/streamService.ts\");\n\n\n\n\n\nasync function onInitSendTransport(event) {\n  const {\n    connectionId,\n    data\n  } = event;\n\n  if (data.type !== \"send\") {\n    throw new Error(\"onInitSendTransport: type should be send\");\n  }\n\n  const connectionInfo = await Object(_serverService__WEBPACK_IMPORTED_MODULE_3__[\"postToServer\"])(\"/connect/init\", data); // TODO: Handle connection removed in between\n\n  await Promise.all([Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"patchConnection\"])({\n    connectionId,\n    sendTransportId: connectionInfo.transportId\n  }), Object(_db_repositories_sendTransportRepository__WEBPACK_IMPORTED_MODULE_1__[\"createSendTransport\"])({\n    transportId: connectionInfo.transportId\n  })]);\n  return connectionInfo;\n}\nasync function onConnectSendTransport(event) {\n  return Object(_serverService__WEBPACK_IMPORTED_MODULE_3__[\"postToServer\"])(\"/connect/create\", event.data);\n}\nasync function closeSendTransport(params) {\n  if (params.transportId == null) {\n    return;\n  }\n\n  const results = await Promise.allSettled([// Keep mediasoup resources for 30s as we might have pending requests\n  // We don't want to have mediasoup in sync, as API is the source of trust\n  // So we don't want to have mediasoup resources removed before API side (hello concurrency hell)\n  // Moreover this could help in future to cancel destroy in case of reconnect\n  Object(_serverService__WEBPACK_IMPORTED_MODULE_3__[\"postToServer\"])(\"/connect/destroy\", {\n    transportId: params.transportId,\n    delay: 30000\n  }), Object(_db_repositories_sendTransportRepository__WEBPACK_IMPORTED_MODULE_1__[\"deleteSendTransport\"])({\n    transportId: params.transportId\n  }), Object(_streamService__WEBPACK_IMPORTED_MODULE_4__[\"closeStream\"])({\n    transportId: params.transportId,\n    producerId: null,\n    destroy: false\n  }), params.skipConnectionPatch ? Promise.resolve(null) : Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_0__[\"patchConnection\"])({\n    connectionId: params.connectionId,\n    sendTransportId: null\n  })]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_2__[\"getAllSettledValues\"])(results, \"closeSendTransport: Unexpected error\");\n}\nasync function onSendTransportClose(event) {\n  await closeSendTransport({ ...event,\n    skipConnectionPatch: false\n  });\n}\n\n//# sourceURL=webpack:///./src/sfu/sendTransportService.ts?");

/***/ }),

/***/ "./src/sfu/serverService.ts":
/*!**********************************!*\
  !*** ./src/sfu/serverService.ts ***!
  \**********************************/
/*! exports provided: requestServer, postToServer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"requestServer\", function() { return requestServer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"postToServer\", function() { return postToServer; });\n/* harmony import */ var node_fetch__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node-fetch */ \"node-fetch\");\n/* harmony import */ var node_fetch__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_fetch__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _db_repositories_serverRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/repositories/serverRepository */ \"./src/db/repositories/serverRepository.ts\");\n\n\n\nasync function getDestServer() {\n  const servers = await Object(_db_repositories_serverRepository__WEBPACK_IMPORTED_MODULE_1__[\"getAllServers\"])();\n\n  if (servers.length === 0) {\n    throw new Error(\"No registered server\");\n  }\n\n  return servers[0];\n}\n\nasync function requestServer(path, options = null) {\n  var _options$headers;\n\n  const server = await getDestServer();\n  const res = await node_fetch__WEBPACK_IMPORTED_MODULE_0___default()(`http://${server.ip}:${server.port}${path}`, { ...options,\n    headers: { ...((_options$headers = options === null || options === void 0 ? void 0 : options.headers) !== null && _options$headers !== void 0 ? _options$headers : null),\n      \"x-api-key\": server.token\n    }\n  });\n\n  if (!res.ok) {\n    const err = await res.json().then(body => body.error).catch(() => \"Unknown SFU error\");\n    throw new Error(`requestSFU: fail with ${err}`);\n  }\n\n  const body = await res.json();\n\n  if (!body.success) {\n    throw new Error(`requestSFU: fail with ${body.error}`);\n  }\n\n  return body.payload;\n}\nasync function postToServer(path, data) {\n  const options = {\n    method: \"POST\",\n    headers: {\n      \"content-type\": \"application/json\"\n    },\n    body: JSON.stringify(data)\n  };\n  return requestServer(path, options);\n}\n\n//# sourceURL=webpack:///./src/sfu/serverService.ts?");

/***/ }),

/***/ "./src/sfu/streamConsumerService.ts":
/*!******************************************!*\
  !*** ./src/sfu/streamConsumerService.ts ***!
  \******************************************/
/*! exports provided: decodeRecvParams, onCreateStreamConsumer, decodeChangeStreamConsumerStateData, onChangeStreamConsumerState, closeConsumer, closeConsumerOf, onConsumerStateChange, getStreamConsumerState */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"decodeRecvParams\", function() { return decodeRecvParams; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onCreateStreamConsumer\", function() { return onCreateStreamConsumer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"decodeChangeStreamConsumerStateData\", function() { return decodeChangeStreamConsumerStateData; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onChangeStreamConsumerState\", function() { return onChangeStreamConsumerState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"closeConsumer\", function() { return closeConsumer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"closeConsumerOf\", function() { return closeConsumerOf; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onConsumerStateChange\", function() { return onConsumerStateChange; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getStreamConsumerState\", function() { return getStreamConsumerState; });\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ts.data.json */ \"ts.data.json\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ts_data_json__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/repositories/connectionRepository */ \"./src/db/repositories/connectionRepository.ts\");\n/* harmony import */ var _db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../db/repositories/streamConsumerRepository */ \"./src/db/repositories/streamConsumerRepository.ts\");\n/* harmony import */ var _db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../db/repositories/streamRepository */ \"./src/db/repositories/streamRepository.ts\");\n/* harmony import */ var _io_io__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../io/io */ \"./src/io/io.ts\");\n/* harmony import */ var _io_promises__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../io/promises */ \"./src/io/promises.ts\");\n/* harmony import */ var _serverService__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./serverService */ \"./src/sfu/serverService.ts\");\n\n\n\n\n\n\n\nconst decodeRecvParams = ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].object({\n  transportId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  sourceTransportId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  producerId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  rtpCapabilities: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].succeed\n}, \"ReceiveParams\");\nasync function onCreateStreamConsumer(event) {\n  const {\n    connectionId,\n    data\n  } = event;\n  const [connection, stream] = await Promise.all([Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_1__[\"getConnection\"])({\n    connectionId\n  }), Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_3__[\"getStream\"])(data.sourceTransportId, data.producerId)]);\n\n  if (connection === null || connection.recvTransportId === null) {\n    throw new Error(\"onCreateStreamConsumer: connection or recvTransportId does not exists\");\n  }\n\n  if (stream === null) {\n    throw new Error(\"onCreateStreamConsumer: stream does not exists\");\n  }\n\n  const payload = await Object(_serverService__WEBPACK_IMPORTED_MODULE_6__[\"postToServer\"])(\"/receive/create\", { ...data,\n    // Force transportId for security reasons\n    transportId: connection.recvTransportId\n  }); // TODO: if exists?\n\n  const streamConsumer = {\n    connectionId,\n    transportId: connection.recvTransportId,\n    sourceTransportId: data.sourceTransportId,\n    producerId: data.producerId,\n    consumerId: payload.consumerId,\n    score: 0,\n    producerScore: 0,\n    paused: true,\n    producerPaused: false\n  }; // TODO: Handle connection/transport removed in between\n\n  await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"createStreamConsumer\"])(streamConsumer); // We're forced to get state after, because event might eventually happen in between\n\n  const {\n    score,\n    producerScore,\n    paused,\n    producerPaused\n  } = await Object(_serverService__WEBPACK_IMPORTED_MODULE_6__[\"postToServer\"])(\"/receive/state\", {\n    consumerId: payload.consumerId\n  });\n  await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"patchStreamConsumer\"])({\n    consumerId: streamConsumer.consumerId,\n    transportId: streamConsumer.transportId,\n    score,\n    producerScore,\n    paused,\n    producerPaused\n  });\n  return payload;\n}\nconst decodeChangeStreamConsumerStateData = ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].object({\n  transportId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  consumerId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  state: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].oneOf([ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"play\"), ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"pause\")], \"state\")\n}, \"ChangeStreamConsumerStateEventData\");\nasync function onChangeStreamConsumerState(event) {\n  const {\n    data: {\n      state,\n      transportId,\n      consumerId\n    }\n  } = event;\n  const streamConsumer = await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"getStreamConsumer\"])(transportId, consumerId);\n\n  if (streamConsumer === null) {\n    return null;\n  }\n\n  if (state === \"play\") {\n    await Object(_serverService__WEBPACK_IMPORTED_MODULE_6__[\"postToServer\"])(\"/receive/play\", {\n      consumerId\n    });\n  }\n\n  if (state === \"pause\") {\n    await Object(_serverService__WEBPACK_IMPORTED_MODULE_6__[\"postToServer\"])(\"/receive/pause\", {\n      consumerId\n    });\n  }\n\n  return null;\n}\nasync function closeConsumer(params) {\n  if (params.consumerId === null) {\n    await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"deleteStreamConsumerByTransportId\"])(params.transportId);\n  } else {\n    await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"deleteStreamConsumer\"])(params.transportId, params.consumerId);\n  }\n}\nasync function closeConsumerOf(params) {\n  await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"deleteStreamConsumerBySoourceTransportId\"])(params.sourceTransportId);\n}\nasync function onConsumerStateChange(event) {\n  const {\n    transportId,\n    consumerId,\n    state: {\n      score,\n      producerScore,\n      paused,\n      producerPaused\n    }\n  } = event;\n  const [streamConsumer, connections] = await Promise.all([Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"getStreamConsumer\"])(transportId, consumerId), Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_1__[\"findConnectionByRecvTransportId\"])(transportId)]);\n\n  if (streamConsumer === null) {\n    return false;\n  }\n\n  const results = await Promise.allSettled([Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"patchStreamConsumer\"])({\n    transportId,\n    consumerId,\n    score,\n    producerScore,\n    paused,\n    producerPaused\n  }), ...connections.map(async connection => Object(_io_io__WEBPACK_IMPORTED_MODULE_4__[\"postToConnection\"])(connection.connectionId, JSON.stringify({\n    type: \"event\",\n    payload: {\n      type: \"streamConsumer:state\",\n      data: { ...streamConsumer,\n        score,\n        producerScore,\n        paused,\n        producerPaused\n      }\n    }\n  })))]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_5__[\"getAllSettledValues\"])(results, \"onConsumerStateChange: Unexpected error\");\n  return true;\n}\nasync function getStreamConsumerState(params) {\n  var _consumer$paused, _consumer$producerPau, _consumer$score, _consumer$producerSco;\n\n  const consumer = await Object(_db_repositories_streamConsumerRepository__WEBPACK_IMPORTED_MODULE_2__[\"getStreamConsumer\"])(params.consumerId, params.transportId);\n  return {\n    paused: (_consumer$paused = consumer === null || consumer === void 0 ? void 0 : consumer.paused) !== null && _consumer$paused !== void 0 ? _consumer$paused : true,\n    producerPaused: (_consumer$producerPau = consumer === null || consumer === void 0 ? void 0 : consumer.producerPaused) !== null && _consumer$producerPau !== void 0 ? _consumer$producerPau : true,\n    score: (_consumer$score = consumer === null || consumer === void 0 ? void 0 : consumer.score) !== null && _consumer$score !== void 0 ? _consumer$score : 0,\n    producerScore: (_consumer$producerSco = consumer === null || consumer === void 0 ? void 0 : consumer.producerScore) !== null && _consumer$producerSco !== void 0 ? _consumer$producerSco : 0\n  };\n}\n\n//# sourceURL=webpack:///./src/sfu/streamConsumerService.ts?");

/***/ }),

/***/ "./src/sfu/streamService.ts":
/*!**********************************!*\
  !*** ./src/sfu/streamService.ts ***!
  \**********************************/
/*! exports provided: decodeSendParams, onCreateStream, decodeOnChangeStreamStateData, onChangeStreamState, closeStream, onProducerStateChange */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"decodeSendParams\", function() { return decodeSendParams; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onCreateStream\", function() { return onCreateStream; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"decodeOnChangeStreamStateData\", function() { return decodeOnChangeStreamStateData; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onChangeStreamState\", function() { return onChangeStreamState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"closeStream\", function() { return closeStream; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"onProducerStateChange\", function() { return onProducerStateChange; });\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ts.data.json */ \"ts.data.json\");\n/* harmony import */ var ts_data_json__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ts_data_json__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../db/repositories/connectionRepository */ \"./src/db/repositories/connectionRepository.ts\");\n/* harmony import */ var _db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../db/repositories/streamRepository */ \"./src/db/repositories/streamRepository.ts\");\n/* harmony import */ var _io_io__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../io/io */ \"./src/io/io.ts\");\n/* harmony import */ var _io_promises__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../io/promises */ \"./src/io/promises.ts\");\n/* harmony import */ var _serverService__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./serverService */ \"./src/sfu/serverService.ts\");\n/* harmony import */ var _streamConsumerService__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./streamConsumerService */ \"./src/sfu/streamConsumerService.ts\");\n\n\n\n\n\n\n\nconst decodeSendParams = ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].object({\n  transportId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  kind: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].oneOf([ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"audio\"), ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"video\")], \"kind\"),\n  rtpParameters: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].succeed\n}, \"SendParams\");\nasync function onCreateStream(event) {\n  const {\n    connectionId,\n    data\n  } = event;\n  const connection = await Object(_db_repositories_connectionRepository__WEBPACK_IMPORTED_MODULE_1__[\"getConnection\"])({\n    connectionId\n  });\n\n  if (connection === null || connection.sendTransportId === null) {\n    throw new Error(\"onCreateStream: connection or sendTransportId does not exists\");\n  }\n\n  const producerId = await Object(_serverService__WEBPACK_IMPORTED_MODULE_5__[\"postToServer\"])(\"/send/create\", { ...data,\n    // Force transportId for security reasons\n    transportId: connection.sendTransportId\n  }); // TODO: if exists?\n\n  const stream = {\n    transportId: connection.sendTransportId,\n    producerId,\n    kind: data.kind,\n    score: 0,\n    paused: false\n  }; // TODO: Handle connection/transport removed in between\n\n  await Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"createStream\"])(stream); // We're forced to get score after, because event might eventually happen in between\n\n  const {\n    score,\n    paused\n  } = await Object(_serverService__WEBPACK_IMPORTED_MODULE_5__[\"postToServer\"])(\"/send/state\", {\n    producerId\n  });\n  const results = await Promise.allSettled([Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"patchStream\"])({ ...stream,\n    score\n  }), Object(_io_io__WEBPACK_IMPORTED_MODULE_3__[\"broadcastToConnections\"])(JSON.stringify({\n    type: \"event\",\n    payload: {\n      type: \"stream:add\",\n      data: { ...stream,\n        score,\n        paused\n      }\n    }\n  }))]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_4__[\"getAllSettledValues\"])(results, \"onCreateStream: Unexpected error\");\n  return producerId;\n}\nconst decodeOnChangeStreamStateData = ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].object({\n  transportId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  producerId: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].string,\n  state: ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].oneOf([ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"close\"), ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"pause\"), ts_data_json__WEBPACK_IMPORTED_MODULE_0__[\"JsonDecoder\"].isExactly(\"play\")], \"state\")\n}, \"ChangeStreamStateEventData\");\nasync function onChangeStreamState(event) {\n  const {\n    data: {\n      state,\n      transportId,\n      producerId\n    }\n  } = event;\n  const stream = await Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"getStream\"])(transportId, producerId);\n\n  if (stream === null) {\n    return null;\n  } // TODO: Check connectionId?\n\n\n  if (state === \"play\") {\n    await Object(_serverService__WEBPACK_IMPORTED_MODULE_5__[\"postToServer\"])(\"/send/play\", {\n      producerId\n    });\n  }\n\n  if (state === \"pause\") {\n    await Object(_serverService__WEBPACK_IMPORTED_MODULE_5__[\"postToServer\"])(\"/send/pause\", {\n      producerId\n    });\n  }\n\n  if (state === \"close\") {\n    const results = await Promise.allSettled([Object(_serverService__WEBPACK_IMPORTED_MODULE_5__[\"postToServer\"])(\"/send/destroy\", {\n      transportId,\n      producerId,\n      delay: 120000\n    }), Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"deleteStream\"])(transportId, producerId), Object(_io_io__WEBPACK_IMPORTED_MODULE_3__[\"broadcastToConnections\"])(JSON.stringify({\n      type: \"event\",\n      payload: {\n        type: \"stream:remove\",\n        data: transportId\n      }\n    }))]);\n    Object(_io_promises__WEBPACK_IMPORTED_MODULE_4__[\"getAllSettledValues\"])(results, \"onChangeStreamState: Unexpected error\");\n  }\n\n  return null;\n}\nasync function closeStream(params) {\n  const results = await Promise.allSettled([Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"deleteStreamByTransportId\"])(params.transportId), Object(_streamConsumerService__WEBPACK_IMPORTED_MODULE_6__[\"closeConsumerOf\"])({\n    sourceTransportId: params.transportId,\n    destroy: false\n  }), Object(_io_io__WEBPACK_IMPORTED_MODULE_3__[\"broadcastToConnections\"])(JSON.stringify({\n    type: \"event\",\n    payload: {\n      type: \"stream:remove\",\n      data: params.transportId\n    }\n  }))]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_4__[\"getAllSettledValues\"])(results, \"closeStream: Unexpected error\");\n}\nasync function onProducerStateChange(event) {\n  const {\n    transportId,\n    producerId,\n    state: {\n      score,\n      paused\n    }\n  } = event;\n  const stream = await Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"getStream\"])(transportId, producerId);\n\n  if (stream === null) {\n    return false;\n  }\n\n  const results = await Promise.allSettled([Object(_db_repositories_streamRepository__WEBPACK_IMPORTED_MODULE_2__[\"patchStream\"])({\n    transportId,\n    producerId,\n    score,\n    paused\n  }), Object(_io_io__WEBPACK_IMPORTED_MODULE_3__[\"broadcastToConnections\"])(JSON.stringify({\n    type: \"event\",\n    payload: {\n      type: \"stream:state\",\n      data: { ...stream,\n        score,\n        paused\n      }\n    }\n  }))]);\n  Object(_io_promises__WEBPACK_IMPORTED_MODULE_4__[\"getAllSettledValues\"])(results, \"onProducerStateChange: Unexpected error\");\n  return true;\n}\n\n//# sourceURL=webpack:///./src/sfu/streamService.ts?");

/***/ }),

/***/ "@sentry/node":
/*!*******************************!*\
  !*** external "@sentry/node" ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"@sentry/node\");\n\n//# sourceURL=webpack:///external_%22@sentry/node%22?");

/***/ }),

/***/ "aws-sdk":
/*!**************************!*\
  !*** external "aws-sdk" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"aws-sdk\");\n\n//# sourceURL=webpack:///external_%22aws-sdk%22?");

/***/ }),

/***/ "dynamoose":
/*!****************************!*\
  !*** external "dynamoose" ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"dynamoose\");\n\n//# sourceURL=webpack:///external_%22dynamoose%22?");

/***/ }),

/***/ "node-fetch":
/*!*****************************!*\
  !*** external "node-fetch" ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"node-fetch\");\n\n//# sourceURL=webpack:///external_%22node-fetch%22?");

/***/ }),

/***/ "source-map-support/register":
/*!**********************************************!*\
  !*** external "source-map-support/register" ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"source-map-support/register\");\n\n//# sourceURL=webpack:///external_%22source-map-support/register%22?");

/***/ }),

/***/ "ts.data.json":
/*!*******************************!*\
  !*** external "ts.data.json" ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"ts.data.json\");\n\n//# sourceURL=webpack:///external_%22ts.data.json%22?");

/***/ }),

/***/ "uuid":
/*!***********************!*\
  !*** external "uuid" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"uuid\");\n\n//# sourceURL=webpack:///external_%22uuid%22?");

/***/ })

/******/ })));